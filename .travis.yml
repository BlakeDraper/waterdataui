language: python

python:
  - "3.6.5"

addons:
  firefox: "latest"

env:
  global:
    # BrowserStack credentials:
    - secure: "Q0B17ffX76zmYC76nsd3HZqXtNVF1UZATsmgI7q/AUr7QdVqmft/p807ekZfWDs1NBsZyMWyrjzKCVbrl7RxvAPIAzm1d62MxCK67lPGvMWJ1vMXjeQ9Oq1wOu48k3HGYvVMP/rtwRv6cEfaVINZ/IvsgA5XaYyukAgmea3OBRY3zUKtV3TBGXxgRkC5fVXIdO13n3XS60b94rPFy7ENV84Rcis2tJrpnreWf4khVqnWXMhgRRt5dzCpJT8K78MraANqUb9dfHq5mBrYjEdlywWjMdcE0zFvCKs3Q62tuIvB+FAOkfiYJ0AmeFzkVHvNQ4ZYeZlofqnGK8b9AMdtCMu30jhiXIrkhAIQrq75HG0UISllL0ZhrYGH4VrIKzqlyg+Lfz/YhifrnsX824tie8QMsooKgn41rGUDyPLklM+i9q67FAPzLjl3h+D2yxsIiGkz0keuHwkDCAVm7TW/H+UgS9DlmIe8snYU31R67f9pI10hRYgL6DAuGnq7hPn7I9Df8DGdly3S4SWDur7mPjs8n0/1llBnBej4iLmFue+8dya1MCFOTTDL8RmMZkAMoE+n5urrCYm78ICQpTzhTaT4bCmhRsurTB6AAmiw4nG3csvOKkMocFAZI3PycK3GCmgnKcZQkDjrhu/f7D9JQZMJgS0hVDL/Vub2fPFv/Qo="
    - secure: "aVqKYPqkzAD+Gfs/Nmw5+XvkxynbAd61/vKyeUKBJEn8wU8k4JdzPw8PWv5Y1Lgw6Ve+PLkWfe5HEARyQNZep8hRvOcoV1sHm1NXE5en6NBiA5lzhgpdZ/l0goIpuzrJMe/gnSZxNZiBkKbhoLpQR18GPDhWzdkCEXoNbxhQLdegnYYXVdt/cla/p9lcR7go4eAL4Rr7aonm1mkC7FepsLlYb1bG9UPDmgIwMf640Fwb9tChIF91QpsXhqqqGd/uPZdcXpmmbi2VjGtxv8Gu+3AYtHhJiVrK6FDSfFEwb6eJq3vS/UXLhgqf+09R+V1PjRNOyQyqDW98DTGvBTz9uuiHPnuH5AjFl2KNceGz1qCu6re5YQZzPghw6hggMRjYL3pfWU+2xSzG1oq6qGmemqpP2EOWBi7MMmrxZsW42P1CqV3vhgsfHZqyMZaKJTluJL7O8zuxIua/l65ThV76eXr+rkHYW6o6OLpx86t5t80djqY9vCYjxOc0V/yqvr3o14bkbfskz/9BxGj5olOXeKPnqkypHfT5ggj3eAkpLAPuioqyH10JD/oZJfX+OyphB55YWZ3dn6rWT8X9FWCRV6B6FvzheCLX5CTZ1MVRHIxojfBE2UrVNLZbWuYvxqGjc3kx8CHk2N4wKFivC6FiSdy2rxJYG4pzZUo2XJ8o55w="
    # SauceLabs credentials:
    - secure: "jiwx0CDbm0HMRfaie0WusvJgS//vIj+zqQQ+rXuzu3Bd0Xk5tepPuRBSeHHQjJ+SkFqklEf2SRS730Pw1uA/xMHooYFqjQ/UP6AcKVqBfxNueKdl/G5hzZ/a+ulY1MxWeM86ZsWgaAVrAid9zsZUsNUZ/4yWah8YJDoWlfHpvoDsu9V9PB+iNq79RmufoMhpqD2Lnc+0xXNxsMOUmSBwEl6slAqDKxrSaNF/rdnEpO2IA1/RE5Xte+SeNb2+mQ5TydDf2qUyGJGZCry60BKARDGdSSHpzJpzOMOeFo437ITMlDZVM7T9trRBeqfwhG96ePLbaym5SO+9aKVCukYePMbRrdUUxsrVbjmCK0CXxbD99z3zFMSkfXIDAusr89d/2QtrDquA1PuzrVPBNJsSKwlB6vTjD6d+7Ym6UvR3btkNaGj0YG+U0xAbA3wzo/PknzLdT82+jIiwn2bU2lDACn6ZUQZ+gVWl4qkRxMt2VnsEVWO14ikB3+czToAxct5VX+6oqIfTk/JKmPLrXQbwi+pCJKOHlvEzFnQ5z+ljcFCiotgbk1dFQ2iC8XR8j1JmN9PAZ1rcR3ZZ7WXdB+7STDe+3LDECYxso/xi0xA5PU5o+SUbwlYnyoJdRLk4/avI2BKB2x1XOG/Uv0MUWlriy7BuuqeM64xnzuKy7kdHLJs="
    - secure: "dLCPZ+fQJG894ZM2EXs3EXeqnC9Vc0ebZ1g7o5FzUq40/OjrggV9y6h3YuOh1qNomfsMGBMwCp/Uc7FQlk/JA04FLJ6ESWG4Q/hPFfg0YOtyn6gjpb2I4OMocGHKuFeBz6Yri0HcPuXPcGwBRcfnm3yGIPFe0kmoaRVzZcsEjHcJ3CbfIJJcDMVY72odcRgfVnW490OvNZNjr5Z0ZBpBqVqxRGwjOGigwb+wtgxiL6hODyU0RJC+kC0b0rO+hlzpO7FhLxoJge5gJuV/U5I54S0J7qxfM+x2pmP1sW9IcONbHdXx6SNhcHeO+hsQZE/B1/eKaNLl50vz9L8QGTqHhRSrP+7y42EVP7qV5vW1VQ3FWehL3grTXH7a0HO00lg3gr3gyBZWG/DUXPZ3bbIIg3oKKC9bewTYvNaH27qeP1UM4Q7j3zQZgCVM+HlDlJcMOttBs77xymxYXfsj5Vl3+dcfs1St0MdgSNoLJ61Ldeuxf6J+tHjE+OuiMRE4DfiSnRRLTI46E+zsLthuQ7MOvsU3We+uj4088vbIg7m3JsTYRN+6wxLROsLHFIh7QTaFDnxW917cx05T4tMVx0/+Dob0crsNJVEUSF7xk5O+E/dNlESix9uOv9F4Ta9XwvchJRUxvBWE6mqbqi+/a87GB+5c0CqM1rKoyimELPIV6XU="
  matrix:
    - KARMA_BROWSERSTACK=1 COVERAGE=1 TEST_TARGET="test"
    - KARMA_SAUCE_LABS=1 TEST_TARGET="test-assets"

matrix:
  allow_failures:
    env:
      - KARMA_SAUCE_LABS=1

before_install:
  - nvm install $(python -c "import json; print(json.loads(open('./assets/package.json').read())['engines']['node'])")

install:
  - make env
  - gem install coveralls-lcov

before_script:
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - mkdir coverage

script:
  - make $(TEST_TARGET)

after_success:
  - "[[ -n $COVERAGE ]] && make coverage"

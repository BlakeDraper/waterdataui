language: python

python:
  - "3.6.5"

addons:
  firefox: "latest"
  # sauce_connect: true

env:
  global:
    # BrowserStack credentials - Need to create encrypted BROWSER_STACK_USERNAME and BROWSER_STACK_ACCESS_KEY environment variables.
    - secure: "BCJ5xZpOHV+EU8AZiU/Vc7jW8AGACsXKE/XGbb3KVbXj4BPQPTACrjxRaga2kDFk/quUPpiIe26V4v2kVnrpLsgrWxlDzMsBCdn+iRoPDKO9mdN1t6WElh/kOeWcW/mEuK1gGh7eYuSq24EdJUfsPy2m31WifccMTDlSaCryY1sXjUd96dFo/fk+Db+9XKcxI3j9Dqr+18UZHjzQF7GJMIp4afhtImoGi69DgdHZDf/panF/YRLUT8vxT06dMNYE08iCm7ONaVNZK1KtpFSBflKlCw0VPTBksiLgT70K/lBzmOe6IBKRl4pCX2Hkd4Uq/P0uFG0aeuOB4RkTuvTx3oNyUyaEk+xEiCkQH/GjDNHurNA6A50UTcbuuyOEncdmkf9T09B7RlrOTGPwaTLtBnqU2yK3eN5ESmsewxrhq+tFtAngUmm45rm5b1CFoS2gmzXX8EFvvGFgXGT+po6jXCKElBIsiNGdDEYTcDfH2C6Cftvj+xnsm61U/GSNBhopt6kF/fusYGejv5aH4YH6jN0FDValVApl7VerO1ZSW/SrEr6UdHQH2JdklqzyyXNcklIF/I3D8UH+2eoRWVMQ9h6Q0dTMxGtAAXiNrt4DSQgjd6W20l0FLJC2TIFazERVvdgYQw4XGbcliq49R+vMz3KJCy6hibAznGLWNy60tFo="
    - secure: "drSHA/Rg252t/f/c12uaJs0zmsJaNECzS1Cl+hWcxkJzk3Ojucryl4kShrCGkxUcegquYmIpOo6r3rS+noKlmQhsvJJSIZLTYud9TlGjdpViNIluaYzHj4JoKMk3f2lV7n+lrYMGGLFSTeIriWj5IK2kydJMbMCuvrKrFm83Jm1ITlvD5tJEy+EHBBkCHAE83+lmVFC3USPEGAO0YthDn+NdZy+JADDAvmfQ1bTCJRfPUUNGjiEGy+cmteWmbHARzeaaIyySky8bzVd2ILQqgz2dO9tLWSvnLC8AxYddRrhaMQQttVQTr+0tmVeCeOcl7GLsX7BaH/jDPKARP0ZkuK1WgpSlgVvkSx0HePGU+f1U+iFd+YnavNYIYNim+SCCEbqcarUJQJU43urlRuNoEriJdq/qc64snf+nxp+BUgmhB/GBtoGbAhDYb8WPd9Hu9ZmCnGhGsO03o5ttgVyRebEJYLsrUu2Qhk7NHTDaDx3R/Ttdtn1t6l9XDUpjB+VFks8b6SyrBuF7tNSE6Ly6bBDoWCxK6J2Llb//VgSFx+27uTPfy8vAkS9T2MW9jarQauhRHI2LkSRTYJHq8odbIfdCBH+Ucb/nGHxRbldoSZBkuBpUmg5xwr9uC0ezuZcV0Zmm7gqZKQoMS/RxOUjx3+emJpIRz4PNm1MeVWbcdeI="
    # SauceLabs credentials:
  # - secure: "joQWAKGrqlg5Ua33G8UHNB7LxgSZHFnZqTev11BLSNlZhIJxFrl7x0CyxvxRUq6s+Fppbrqz9qu0RTqqRWtqUCfKxLiEprSH2RcK5OvPhX0DsWj6mOsJz8WM2DItB6zDmTTRojgTCehw+mXrVhkW+tVrSdLqs3a/ef7YOool5tsae2lQs2wuoIg3k8nTQP9RE2YXBAQRbLPA/nEOHWaERsefb3gZwONNu6KHDnhaUXHXjnbo2eMBS8H8H7fmMrU178Pz5zno8d0Eg26370DEFdOGlX/YX4aiqZzS8AhG9uNY0yG+8n8uY6rNJmwbpxXC2AuPHvlTsKd6kZXn+lEHFkMYG0gGOjLIUU80SWadOYkwzMrM1bhcSNMTWk3C0aV3wHXVaoSlGX2pfgXOXcrPbNNbMz2I+bgvXhXBbiGE7Zc810Nr18CIcRQ5mbCjxBJk7cUReRIkq3PGIzOjYRjbT0nhkVWCfNoDkOZHvjXNIWJIi7d+w78d1CJa7/z3HyFwS5wpNrjxkdE2UPHL1y1RrBLl25nxy9KUWOImfeYbym12tebVX4TPH3WrLkCGFT3OEt/B2f2HEF614kA2JNR3cB5jvWT94SJybEAtk6RFPf9qjrbAfBg5SeqzZ17/vJmmZxDcHzuze1+tLFZPXNNHBwyqt4TI9MxdYZb+L328qjY="
  # - secure: "imY7FAhE1vhXy74SjrwNxnfTvr6jwMS4O+wURCNNdjP2it+klHqguBKSIAt/ZoFGhN5sx4faqKu0HGf3ya/TA87Suh1FJFX9+IgpU1c3mVtvOCJKVhITNM8Oyncza1FO9rOinUXKHHAA5a4sCdUFFx+rDGGGoUozr2lacGq3TuHjyji5+phLxGJ/EExFoV4kE7u7nTSCAVJKIvF4ERzJvij9fWAs//vjnHNhb5uGIPAy8JNRgDGMX/YnyexaVN91pNFsoRIkVeyxYPQNsPT2lLf0vRuI/6Ce5i2uOJpfxn5HMpyeHlIb6qRM6pR6FrcfPxxyY5FK4sTbYZjpKOQAc5y1K3PdukaGYkWIKAZjwzzD8L9mVZmOfafC/4nCWdhh9JAzSFUM6guHKyM8zFKdpUz9mZkY+v1AvnZCb3dj52KBJ+tK/rGo6o8HVt6isu6sN6PMdMWELWjdcSucwzxgvsgvUln1nbCx4e0/8u9v4zV9hcnbGBZX3gZO6vtosyeDrqeuaTCCRqWBgVXHHsWsTz+1UTvJkIFGZpszQDO2pyh5vQ6/WcLqkFl0JA8u5Ti1xRMRu+KJSIc4tT8D22f2tJnZPyyIwjZbctn27Bm2LFRFWGkY545A2GOtDG8RxEAgQyIkL+FsC9/ljN3Xpc/AaTMfqKe5qVZQusdzV7sb7kE="
  matrix:
    - KARMA_BROWSERSTACK=1 COVERAGE=1 TEST_TARGET=test
    # - KARMA_SAUCE_LABS=1 TEST_TARGET=test-assets

matrix:
  fast_finish: true
  # allow_failures:
  #  - env: KARMA_SAUCE_LABS=1 TEST_TARGET=test-assets

before_install:
  - nvm install $(python -c "import json; print(json.loads(open('./assets/package.json').read())['engines']['node'])")

install:
  - make env
  - gem install coveralls-lcov

before_script:
  - mkdir coverage

script:
  - make "$TEST_TARGET"

after_success:
  - "[[ -n $COVERAGE ]] && make coverage"

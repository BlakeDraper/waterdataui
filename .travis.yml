language: python

python:
  - "3.6.5"

addons:
  firefox: "latest"
  sauce_connect: true

env:
  global:
    # BrowserStack credentials:
    - secure: "Q0B17ffX76zmYC76nsd3HZqXtNVF1UZATsmgI7q/AUr7QdVqmft/p807ekZfWDs1NBsZyMWyrjzKCVbrl7RxvAPIAzm1d62MxCK67lPGvMWJ1vMXjeQ9Oq1wOu48k3HGYvVMP/rtwRv6cEfaVINZ/IvsgA5XaYyukAgmea3OBRY3zUKtV3TBGXxgRkC5fVXIdO13n3XS60b94rPFy7ENV84Rcis2tJrpnreWf4khVqnWXMhgRRt5dzCpJT8K78MraANqUb9dfHq5mBrYjEdlywWjMdcE0zFvCKs3Q62tuIvB+FAOkfiYJ0AmeFzkVHvNQ4ZYeZlofqnGK8b9AMdtCMu30jhiXIrkhAIQrq75HG0UISllL0ZhrYGH4VrIKzqlyg+Lfz/YhifrnsX824tie8QMsooKgn41rGUDyPLklM+i9q67FAPzLjl3h+D2yxsIiGkz0keuHwkDCAVm7TW/H+UgS9DlmIe8snYU31R67f9pI10hRYgL6DAuGnq7hPn7I9Df8DGdly3S4SWDur7mPjs8n0/1llBnBej4iLmFue+8dya1MCFOTTDL8RmMZkAMoE+n5urrCYm78ICQpTzhTaT4bCmhRsurTB6AAmiw4nG3csvOKkMocFAZI3PycK3GCmgnKcZQkDjrhu/f7D9JQZMJgS0hVDL/Vub2fPFv/Qo="
    - secure: "aVqKYPqkzAD+Gfs/Nmw5+XvkxynbAd61/vKyeUKBJEn8wU8k4JdzPw8PWv5Y1Lgw6Ve+PLkWfe5HEARyQNZep8hRvOcoV1sHm1NXE5en6NBiA5lzhgpdZ/l0goIpuzrJMe/gnSZxNZiBkKbhoLpQR18GPDhWzdkCEXoNbxhQLdegnYYXVdt/cla/p9lcR7go4eAL4Rr7aonm1mkC7FepsLlYb1bG9UPDmgIwMf640Fwb9tChIF91QpsXhqqqGd/uPZdcXpmmbi2VjGtxv8Gu+3AYtHhJiVrK6FDSfFEwb6eJq3vS/UXLhgqf+09R+V1PjRNOyQyqDW98DTGvBTz9uuiHPnuH5AjFl2KNceGz1qCu6re5YQZzPghw6hggMRjYL3pfWU+2xSzG1oq6qGmemqpP2EOWBi7MMmrxZsW42P1CqV3vhgsfHZqyMZaKJTluJL7O8zuxIua/l65ThV76eXr+rkHYW6o6OLpx86t5t80djqY9vCYjxOc0V/yqvr3o14bkbfskz/9BxGj5olOXeKPnqkypHfT5ggj3eAkpLAPuioqyH10JD/oZJfX+OyphB55YWZ3dn6rWT8X9FWCRV6B6FvzheCLX5CTZ1MVRHIxojfBE2UrVNLZbWuYvxqGjc3kx8CHk2N4wKFivC6FiSdy2rxJYG4pzZUo2XJ8o55w="
    # SauceLabs credentials:
    - secure: "joQWAKGrqlg5Ua33G8UHNB7LxgSZHFnZqTev11BLSNlZhIJxFrl7x0CyxvxRUq6s+Fppbrqz9qu0RTqqRWtqUCfKxLiEprSH2RcK5OvPhX0DsWj6mOsJz8WM2DItB6zDmTTRojgTCehw+mXrVhkW+tVrSdLqs3a/ef7YOool5tsae2lQs2wuoIg3k8nTQP9RE2YXBAQRbLPA/nEOHWaERsefb3gZwONNu6KHDnhaUXHXjnbo2eMBS8H8H7fmMrU178Pz5zno8d0Eg26370DEFdOGlX/YX4aiqZzS8AhG9uNY0yG+8n8uY6rNJmwbpxXC2AuPHvlTsKd6kZXn+lEHFkMYG0gGOjLIUU80SWadOYkwzMrM1bhcSNMTWk3C0aV3wHXVaoSlGX2pfgXOXcrPbNNbMz2I+bgvXhXBbiGE7Zc810Nr18CIcRQ5mbCjxBJk7cUReRIkq3PGIzOjYRjbT0nhkVWCfNoDkOZHvjXNIWJIi7d+w78d1CJa7/z3HyFwS5wpNrjxkdE2UPHL1y1RrBLl25nxy9KUWOImfeYbym12tebVX4TPH3WrLkCGFT3OEt/B2f2HEF614kA2JNR3cB5jvWT94SJybEAtk6RFPf9qjrbAfBg5SeqzZ17/vJmmZxDcHzuze1+tLFZPXNNHBwyqt4TI9MxdYZb+L328qjY="
    - secure: "imY7FAhE1vhXy74SjrwNxnfTvr6jwMS4O+wURCNNdjP2it+klHqguBKSIAt/ZoFGhN5sx4faqKu0HGf3ya/TA87Suh1FJFX9+IgpU1c3mVtvOCJKVhITNM8Oyncza1FO9rOinUXKHHAA5a4sCdUFFx+rDGGGoUozr2lacGq3TuHjyji5+phLxGJ/EExFoV4kE7u7nTSCAVJKIvF4ERzJvij9fWAs//vjnHNhb5uGIPAy8JNRgDGMX/YnyexaVN91pNFsoRIkVeyxYPQNsPT2lLf0vRuI/6Ce5i2uOJpfxn5HMpyeHlIb6qRM6pR6FrcfPxxyY5FK4sTbYZjpKOQAc5y1K3PdukaGYkWIKAZjwzzD8L9mVZmOfafC/4nCWdhh9JAzSFUM6guHKyM8zFKdpUz9mZkY+v1AvnZCb3dj52KBJ+tK/rGo6o8HVt6isu6sN6PMdMWELWjdcSucwzxgvsgvUln1nbCx4e0/8u9v4zV9hcnbGBZX3gZO6vtosyeDrqeuaTCCRqWBgVXHHsWsTz+1UTvJkIFGZpszQDO2pyh5vQ6/WcLqkFl0JA8u5Ti1xRMRu+KJSIc4tT8D22f2tJnZPyyIwjZbctn27Bm2LFRFWGkY545A2GOtDG8RxEAgQyIkL+FsC9/ljN3Xpc/AaTMfqKe5qVZQusdzV7sb7kE="
  matrix:
    - KARMA_BROWSERSTACK=1 COVERAGE=1 TEST_TARGET=test
    - KARMA_SAUCE_LABS=1 TEST_TARGET=test-assets

matrix:
  fast_finish: true
  allow_failures:
    - env: KARMA_SAUCE_LABS=1 TEST_TARGET=test-assets

before_install:
  - nvm install $(python -c "import json; print(json.loads(open('./assets/package.json').read())['engines']['node'])")

install:
  - make env
  - gem install coveralls-lcov

before_script:
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - mkdir coverage

script:
  - make "$TEST_TARGET"

after_success:
  - "[[ -n $COVERAGE ]] && make coverage"
